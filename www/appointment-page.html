<!-- Wappler include head-page="index.html" is="dmx-app" id="appointmentpage" appConnect="local" framework7_6="With App Connect" framework7_icons="local" capacitor="local" components="{dmxCalendar:{},dmxSwiper:{},dmxFormatter:{},dmxStripe:{},dmxSockets:{}}" -->

<div class="page" path="/appointment-page/:provider_id" data-name="appointment-page" id="appointmentpage">
    <dmx-serverconnect id="queryProvider_booking_dates" url="https://api.justpro.me/api/provider/query_appointment" site="JustPro-Spa-Backend" dmx-param:date_time="app.main.appointmentpage.form.appointmentDate.value.toDate()" dmx-param:provider_id="app.main.appointmentpage.route.params.provider_id" sockets="true"></dmx-serverconnect>
    <dmx-serverconnect id="query_time_slots" url="https://api.justpro.me/api/provider/available_time_slots" site="JustPro-Spa-Backend" dmx-param:date_time="app.main.appointmentpage.form.appointmentDate.value.toDate()" dmx-param:provider_last_time_slot_end="app.main.appointmentpage.queryProvider_booking_dates.data.provider_last_booking_time_slot.time_start" sockets="true"></dmx-serverconnect>
    <script is="dmx-flow" id="flow1" type="text/dmx-flow" autorun>{
  runJS: {function: "runCalendar"}
}</script>
    <dmx-value id="appointment_timeStart" dmx-bind:value="'9:00 am'"></dmx-value>
    <dmx-value id="appointment_timeEnd" dmx-bind:value="'10:00 am'"></dmx-value>
    <div class="padding-top padding-bottom">
        <div class="navbar shadow">
            <div class="navbar-inner" style="padding-right:0px !important; padding-left:0px !important; margin-right:0px !important">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon f7-icons">arrow_left</i>
                    </a>

                </div>

                <div class="title">Appointment</div>
                <div class="right">
                    <a href="#" class="link panel-open icon-only" data-panel="left">

                        <i class="icon f7-icons">ellipsis_vertical</i>
                    </a>
                </div>
            </div>
        </div>

    </div>
    <div class="toolbar toolbar-bottom toolbar-bottom-md no-shadow">
        <div class="toolbar-inner justify-content-center" style="padding:10px !important">
            <a class="item-link list-button button-large rounded-xl button-6 bg-color-primary button-fill text-color-white" style="width:100%" dmx-on:click="run({condition:{if:`app.main.appointmentpage.form.appointmentDate.value.toDate()`,then:{steps:[{run:{action:`app.Cart.update({customer_id: app.Current_user.data.customer.id},{appointment_date: app.main.appointmentpage.form.appointmentDate.value.toDate(), timeSlot_start: app.main.appointmentpage.appointment_timeStart.value, timeSlot_end: app.main.appointmentpage.appointment_timeEnd.value})`}},{run:{action:`app.main.navigate(\'/choose-address\',{})`}}]},else:{steps:{'f7.dialog.alert':{title:'Appointment Date',text:'Please select an appointment date.'}}}}})">Continue &nbsp;<i class="bi-arrow-right-circle-fill"></i></a>
        </div>
    </div>
    <div class="page-content content-area wappler-block">
        <div class="container">
            <!-- Demo cal -->

            <form id="form" method="post" is="dmx-serverconnect-form">

                <h4 class="tajawal-s bottom-20" style="margin-top:50px">When do you need this service? </h4>
                <div class="block mb-20">
                    <div id="demo-calendar"></div>
                </div>

                <input type="hidden" id="appointmentDate" name="appointmentDate" type="text" placeholder="Select a convenient date" style="width:100%">


            </form>
            <div class="block no-padding" style="margin-top:40px !important">
                <h4 class="tajawal-s mb-10">Select Time Slot <i class="bi bi-chevron-right"></i></h4>
                <div class="flex-buttons">

                    <div data-space-between="0" data-slides-per-view="auto" data-centered-slides="false" class="swiper-container swiper-init tabbar tab-style-1 main-swiper" style="border-top:0px !important; " role="scrollbar">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" dmx-repeat:repeat_available_time_slot="app.main.appointmentpage.query_time_slots.data.query_slots">
                                <div class="flex-shrink-1 margin">
                                    <button class="button button-outline button-round brand-border" dmx-on:click="app.main.appointmentpage.appointment_timeStart.setValue(time_slot_start);app.main.appointmentpage.appointment_timeEnd.setValue(time_slot_end)" dmx-class:brand-btn="(app.main.appointmentpage.appointment_timeStart.value == time_slot_start)" style="width:100% !important">{{time_slot_start.replace(".", ":")+' - '+time_slot_end.replace(".", ":")}}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <P dmx-show="!app.main.appointmentpage.query_time_slots.data.query_slots">Sorry this provider is overbooked on this date</P>
                </div>
            </div>
        </div>

    </div>
</div>