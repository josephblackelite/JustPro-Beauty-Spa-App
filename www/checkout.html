<!-- Wappler include head-page="index.html" is="dmx-app" id="checkout" appConnect="local" framework7_6="With App Connect" framework7_icons="local" capacitor="local" components="{dmxSwiper:{},dmxFormRepeat:{},dmxFormatter:{}}" -->

<div class="page">
    <form is="dmx-serverconnect-form" id="Setup_Intent_ephemeral_key_gen" method="post" action="https://api.justpro.me/api/stripe/create_setup_intent" site="JustPro-Spa-Backend" dmx-on:success="run({runJS:{function:'createPaymentFlow',args:[`app.main.f7page.Setup_Intent_ephemeral_key_gen.data.client_secret`,`app.main.f7page.Setup_Intent_ephemeral_key_gen.data.customer_id`,`app.main.f7page.Setup_Intent_ephemeral_key_gen.data.ephemeral_key`]}})"><input id="User_id" name="user_id" dmx-bind:value="app.Current_user.data.customer.id" type="hidden">
        <input id="setUp" name="setUp" type="hidden" value="setUp">
    </form>
    <dmx-value id="card_setup_started"></dmx-value>
    <div class="navbar" style="margin-top:20px !important">
        <div class="navbar-inner">

            <a href="#" class="link back">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.439312 13.0606L5.75391 18.3752C6.04683 18.6682 6.43069 18.8146 6.81459 18.8146C7.1985 18.8146 7.58236 18.6682 7.87528 18.3752C8.46103 17.7894 8.46103 16.8397 7.87528 16.2539L5.12133 13.5H22.5C23.3284 13.5 24 12.8284 24 12C24 11.1716 23.3284 10.5 22.5 10.5H5.12133L7.87528 7.7461C8.46103 7.1603 8.46103 6.21057 7.87528 5.62477C7.28944 5.03898 6.33975 5.03898 5.75391 5.62477L0.439312 10.9394C-0.146437 11.5251 -0.146437 12.4749 0.439312 13.0606Z" fill="black" />
                </svg>
            </a>
            <div class="title"><img src="assets/images/logo-small.png"></div>
            <div class="right">
                <a href="#" class="link panel-open" data-panel="left">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 12C14 10.8955 13.1046 10 12 10C10.8954 10 10 10.8955 10 12C10 13.1046 10.8954 14 12 14C13.1046 14 14 13.1046 14 12Z" fill="black" />
                        <path d="M14 20C14 18.8954 13.1046 18 12 18C10.8954 18 10 18.8954 10 20C10 21.1045 10.8954 22 12 22C13.1046 22 14 21.1045 14 20Z" fill="black" />
                        <path d="M14 4C14 2.89544 13.1046 2.00001 12 2.00001C10.8954 2.00001 10 2.89544 10 4C10 5.10457 10.8954 6 12 6C13.1046 6 14 5.10457 14 4Z" fill="black" />
                    </svg>
                </a>
            </div>
        </div>
    </div>
    <div class="page-content wappler-block pt-70">
        <form id="items_hidden" is="dmx-serverconnect-form" method="post">
            <div is="dmx-form-repeat" id="formRepeat1" sortable="true" dmx-bind:items="app.Cart.data">
                <input id="text1" name="text1" type="text" dmx-bind:value="items[$index].product_id">
            </div>

        </form>
        <div class="block no-margin">
            <h5>Check out</h5>

        </div>
        <div class="block no-margin">
            <div class="list accordion-list dz-accordion dz-list">
                <ul class="padding">
                    <li class="accordion-item accordion-item-opened">
                        <div href="#" class="">
                            <div class="item-inner display-flex ">
                                <div class="item-title">Your cards</div>
                                <a href="" dmx-on:click="run([{run:{action:`app.main.f7page.card_setup_started.setValue(1)`}},{run:{action:`app.main.f7page.Setup_Intent_ephemeral_key_gen.submit()`}}])" dmx-hide="((app.main.f7page.card_setup_started.value == 1) &amp;&amp; ((app.STRIPE_CARD_SETUP.value != 'Failed') &amp;&amp; (app.STRIPE_CARD_SETUP.value != 'Completed')))">Add new card</a>
                                <div class="preloader color-purple" dmx-show="((app.main.f7page.card_setup_started.value == 1) && ((app.STRIPE_CARD_SETUP.value != 'Failed') && (app.STRIPE_CARD_SETUP.value != 'Completed')))"></div>
                            </div>
                        </div>
                        <div class="accordion-item-content">
                            <div class="item-content-inner mb-30">
                                <!-- Payment Swiper -->
                                <div data-space-between="15" data-slides-per-view="auto" data-centered-slides="false" class="swiper-container swiper-init payment-swiper item-swiper">
                                    <div class="swiper-wrapper">
                                        <div class="swiper-slide">
                                            <div class="payment-card">
                                                <div class="card-media">
                                                    <img src="img/card/card1.png" alt="">
                                                </div>
                                                <div class="card-info">
                                                    <div class="clearfix">
                                                        <h5 class="card-name">Credit Card</h5>
                                                        <p class="card-number">1234 **** **** ****</p>
                                                    </div>
                                                    <div class="bottom-info">
                                                        <p>04 / 25</p>
                                                        <p>KEVIN HARD</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="swiper-slide">
                                            <div class="payment-card">
                                                <div class="card-media">
                                                    <img src="img/card/card2.png" alt="">
                                                </div>
                                                <div class="card-info">
                                                    <div class="clearfix">
                                                        <h5 class="card-name">Credit Card</h5>
                                                        <p class="card-number">1234 **** **** ****</p>
                                                    </div>
                                                    <div class="bottom-info">
                                                        <p>04 / 25</p>
                                                        <p>KEVIN HARD</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>

                </ul>
            </div>
            <div class="checkout-total">
                <p class="title">Total Payment</p>
                <h2 class="checkout-total">{{Cart.data.sum(`total.toNumber()`).formatCurrency('AED', '.', ',', 2)}}</h2>
            </div>
        </div>
        <div class="block"></div>
        <div class="block">
            <p>Transaction amount will be debited immediately after submitting the payment form. It will appear as JustPro Portal Co. LLC in your bank statement, please keep a copy of the transaction data.</p>
            <a href="/checkout" class="button-large rounded-xl button button-fill" dmx-on:click="run({condition:{if:`!app.Current_user.data.customer.customer_email`,then:{steps:{runJS:{function:'showEnterEmailAddressSheet'}}},else:{steps:{condition:{if:`!app.Current_user.data.customer.phone_number`,then:{steps:{runJS:{function:'showVerifyNumberSheet'}}},else:{steps:{run:{action:`app.main.navigate(\'/order-tracking\',{})`}}}}}}}})">Pay</a>
        </div>




        <!-- Verify Number Sheet modal -->
        <div class="sheet-modal verifyNumberSheet">
            <div class="toolbar">
                <div class="toolbar-inner">
                    <div class="left"></div>
                    <div class="title text-align-center">Verify mobile number</div>
                    <div class="right"></div>
                </div>
            </div>
            <div class="sheet-modal-inner">
                <div class="block no-margin-top">
                    <form action="https://api.justpro.me/api/security/verify_user_number" is="dmx-serverconnect-form" method="post" id="verify_user_number" site="JustPro-Spa-Backend" dmx-on:success="run({condition:{if:`(app.main.f7page.verify_user_number.data.exec.api.data.status == \'open\')`,then:{steps:[{runJS:{function:'closeVerifyNumberSheet'}},{runJS:{function:'startOtpWatch'}},{run:{action:`app.otp_id.setValue(app.main.f7page.verify_user_number.data.exec.api.data.otp_id);app.main.navigate(\'/verifyOtp/1\',{})`}}]}}})" class="no-padding" dmx-on:invalid="run({'f7.dialog.alert':{title:'Error',text:`app.main.f7page.verify_user_number.lastError.response`}})">
                        <input id="user_id" name="user_id" type="hidden" dmx-bind:value="app.Current_user.data.customer.id">
                        <div class="list no-margin-top ">
                            <ul class="row">
                                <li class="item-content col-100 item-input item-input-with-value">
                                    <div class="item-inner">
                                        <div class="item-title item-label">Mobile number</div>
                                        <div class="item-input-wrap row">
                                            <div class="col-30"><select id="country_code" class="form-control" name="country_code" dmx-bind:options="app.countryList.data" optiontext="code+' '+dial_code" optionvalue="code" dmx-bind:value="'AE'">
                                                </select>
                                            </div>
                                            <div class="col-70"><input type="number" placeholder="524******" class="form-control" id="mobile_number" dmx-bind:value="app.Current_user.data.customer.phone_number" name="mobile_number" /></div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="clearfix text-align-center pb-30">

                            <button href="" class="button-large button button-fill rounded-xl button-gray color-purple" dmx-on:click="run({condition:{if:`app.main.f7page.verify_user_number.mobile_number.value`,then:{steps:{run:{action:`app.main.f7page.verify_user_number.submit()`}}}}})" dmx-bind:disabled="app.main.f7page.verify_user_number.state.executing"><span dmx-hide="app.main.f7page.verify_user_number.state.executing">Verify my number</span>
                                <div class="preloader color-purple" dmx-show="app.main.f7page.verify_user_number.state.executing"></div>
                            </button>
                        </div>


                    </form>
                </div>
            </div>
        </div>

        <!-- Enter email address Sheet modal -->
        <div class="sheet-modal EnterEmailAddressSheet">
            <div class="toolbar">
                <div class="toolbar-inner">
                    <div class="left"></div>
                    <div class="title text-align-center">Enter email address</div>
                    <div class="right"></div>
                </div>
            </div>
            <div class="sheet-modal-inner">
                <div class="block no-margin-top">
                    <form action="https://api.justpro.me/api/security/collect_user_email_for_checkout" is="dmx-serverconnect-form" method="post" id="enter_email_address" site="JustPro-Spa-Backend" dmx-on:success="run({runJS:{function:'closeEnterEmailAddressSheet'}})" class="no-padding" dmx-on:invalid="run({'f7.dialog.alert':{title:'Error',text:'There is an error'}})"><input id="user__id" name="user_id" type="hidden" dmx-bind:value="app.Current_user.data.customer.id">
                        <div class="list no-margin-top ">
                            <ul class="row">
                                <li class="item-content col-100 item-input">
                                    <div class="item-inner">
                                        <div class="item-title item-label">Email</div>
                                        <div class="item-input-wrap">
                                            <input type="email" placeholder="Email Address" class="form-control" name="email" dmx-bind:value="app.Current_user.data.customer.customer_email">
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="clearfix text-align-center pb-30">

                            <button href="" class="button-large button button-fill rounded-xl button-gray color-purple" dmx-on:click="run({condition:{if:`app.main.f7page.enter_email_address.email.value`,then:{steps:{run:{action:`app.main.f7page.enter_email_address.submit()`}}}}})" dmx-bind:disabled="app.main.f7page.enter_email_address.state.executing"><span dmx-hide="app.main.f7page.enter_email_address.state.executing">Submit</span>
                                <div class="preloader color-purple" dmx-show="app.main.f7page.enter_email_address.state.executing"></div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>

</script>