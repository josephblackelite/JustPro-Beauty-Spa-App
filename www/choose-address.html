<!-- Wappler include head-page="index.html" is="dmx-app" id="chooseaddress" appConnect="local" framework7_6="With App Connect" framework7_icons="local" capacitor="local" components="{dmxDatePicker:{},dmxGoogleMaps:{},dmxGooglePlaces:{},dmxSockets:{},dmxFormatter:{}}" jquery_slim_35="cdn" moment_2="cdn" -->

<div class="page location-tracking" id="chooseaddress" data-name="choose-address" path="/choose-address">
    <dmx-serverconnect id="selected_address_data" url="https://api.justpro.me/api/customer_app/customer_address_actions/selected_address_data" site="JustPro-Spa-Backend" dmx-param:address_id="app.main.chooseaddress.address_select_form.select_address.value" sockets="true"></dmx-serverconnect>

    <script is="dmx-flow" id="showAddressSheet" type="text/dmx-flow" autorun>{
  runJS: {function: "showAddressSheet"}
}</script>

    <div class="navbar no-hairline no-shadow no-border">
        <div class="navbar-inner" style="padding-right:0px !important; padding-left:0px !important; margin-right:0px !important">
            <div class="left">
                <a href="#" class="link back">
                    <i class="icon f7-icons">arrow_left</i>
                </a>

            </div>

            <div class="title">Address</div>
            <div class="right">
                <a href="#" class="link panel-open icon-only" data-panel="left">

                    <i class="icon f7-icons">ellipsis_vertical</i>
                </a>
            </div>
        </div>
    </div>


    <div class="toolbar toolbar-bottom toolbar-bottom-md" dmx-show="app.main.chooseaddress.address_select_form.select_address.value">
        <div class="toolbar-inner justify-content-center" style="padding:10px !important">
            <a class="button-6 button-large button-fill bg-color-primary text-color-white" href="" style="width:100%" dmx-on:click="run({condition:{if:`app.main.chooseaddress.address_select_form.select_address.value`,then:{steps:{condition:{if:`(app.cart_preFill.data.can_be_charged_immmediately == 1)`,then:{steps:[{run:{action:`app.Cart.upsert({provider_service_id: app.cart_preFill.data.provider_service_id},{provider_service_id: app.cart_preFill.data.provider_service_id, product_price_id: app.cart_preFill.data.product_price_id, employee_id: app.selected_employee_id.value, name: app.cart_preFill.data.name, quantity: app.cart_preFill.data.quantity, amount: app.cart_preFill.data.amount, matrix: app.cart_preFill.data.matrix, total: app.cart_preFill.data.total, vat: app.cart_preFill.data.vat, product_avatar: app.cart_preFill.data.product_avatar, address_id: app.main.chooseaddress.address_select_form.select_address.value, appointment_date: app.cart_preFill.data.appointment_date, timeSlot_start: app.cart_preFill.data.timeSlot_start, timeSlot_end: app.cart_preFill.data.timeSlot_end, customer_id: app.cart_preFill.data.customer_id, parent_provider_id: app.cart_preFill.data.parent_provider_id, service_type: app.cart_preFill.data.service_type, service_option_id: app.cart_preFill.data.service_option_id, selected_timeSlot_expired: 0})`}},{run:{action:`app.main.navigate(\'/order-confirmation\',{})`}}]},else:{steps:[{run:{action:`app.appointmentCart.upsert({provider_service_id: app.cart_preFill.data.provider_service_id},{provider_service_id: app.cart_preFill.data.provider_service_id, product_price_id: app.cart_preFill.data.product_price_id, employee_id: app.selected_employee_id.value, name: app.cart_preFill.data.name, quantity: app.cart_preFill.data.quantity, amount: app.cart_preFill.data.amount, matrix: app.cart_preFill.data.matrix, total: app.cart_preFill.data.total, vat: app.cart_preFill.data.vat, product_avatar: app.cart_preFill.data.product_avatar, address_id: app.main.chooseaddress.address_select_form.select_address.value, appointment_date: app.cart_preFill.data.appointment_date, timeSlot_start: app.cart_preFill.data.timeSlot_start, timeSlot_end: app.cart_preFill.data.timeSlot_end, customer_id: app.cart_preFill.data.customer_id, parent_provider_id: app.cart_preFill.data.parent_provider_id, service_type: app.cart_preFill.data.service_type, service_option_id: app.cart_preFill.data.service_option_id, selected_timeSlot_expired: 0})`}},{run:{action:`app.main.navigate(\'/order-confirmation\',{})`}}]}}}},else:{steps:{'f7.dialog.alert':{title:'No address?',text:'Choose or add an address to continue'}}}}})">Continue &nbsp;<i class="bi-arrow-right-circle-fill"></i></a>
        </div>
    </div>
    <div class="fab fab-left-bottom">
        <a href="#" dmx-on:click="app.main.chooseaddress.showAddressSheet.run()">
            <i class="bi bi-geo-alt-fill"></i>
        </a>
    </div>
    <div class="page-content wappler-block pt-70 relative">
        <div>

            <dmx-google-maps id="maps" class="full-page-map" height="100%" zoom-control="true" zoom="20" dmx-bind:address="app.main.chooseaddress.selected_address_data.data.query.full_address" dmx-bind:latitude="app.main.chooseaddress.selected_address_data.data.query.latitude" dmx-bind:longitude="app.main.chooseaddress.selected_address_data.data.query.logitude">
                <dmx-google-maps-marker id="marker1" dmx-bind:address="app.main.chooseaddress.selected_address_data.data.query.full_address" dmx-bind:latitude="app.main.chooseaddress.selected_address_data.data.query.latitude" dmx-bind:longitude="app.main.chooseaddress.selected_address_data.data.query.logitude" animation="drop"></dmx-google-maps-marker>
            </dmx-google-maps>
        </div>


        <!-- Choose address -->
        <div class="sheet-modal address-sheet-swipe-to-step" style="height:auto; --f7-sheet-bg-color: #fff;">
            <div class="toolbar">
                <div class="toolbar-inner justify-content-center">
                    <div class="left"></div>
                    <div class="title text-align-center">Where do you want this service?</div>
                    <div class="right"></div>
                </div>
            </div>

            <div class="sheet-modal-inner">
                <div class="block">
                    <div>
                        <a class="button-18 button-small bg-color-primary button-fill " href="" dmx-on:click="run([{runJS:{function:'closeAddressSheet'}},{run:{action:`app.main.navigate(\'/create-new-address\',{})`}}])" style="width:100%; margin-top:-20px !important">Add a new address</a>
                    </div>
                </div>
                <div class="sheet-modal-swipe-step" dmx-show="app.main.chooseaddress.address_select_form.select_address.value">
                    <!-- -->
                    <div class="">
                        <form action="" is="dmx-serverconnect-form" method="post" id="address_select_form">
                            <div class="list" style="margin-top:-20px !important">
                                <ul class="row">
                                    <li class="item-content item-input item-input-outline" style="width:100% !important">

                                        <div class="item-inner" style="width:100% !important">
                                            <div class="item-title item-floating-label strong">My Saved Address <i class="bi bi-geo-alt-fill"></i></div>
                                            <div class="item-input-wrap">
                                                <select id="select_address" class="form-control" dmx-bind:options="app.Current_user.data.customer.customer_addresses" optionvalue="id" optiontext="address_name" placeholder="My Saved Address" style="width:100% !important" dmx-bind:value="app.local_store.data.customer_last_address_id" dmx-on:changed="app.local_store.set('customer_last_address_id',app.main.chooseaddress.address_select_form.select_address.value)">
                                                    <option value="0">Choose Address</option>
                                                </select>
                                                <span class="input-clear-button"></span>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="block" dmx-show="app.main.chooseaddress.address_select_form.select_address.value">
                    <!-- -->
                    <a href="#!" class="text-align-center button-18 bg-color-blue" dmx-on:click="run({runJS:{function:'closeAddressSheet'}})" style="width:100% !important; margin-top:-20px !important" dmx-show="app.main.chooseaddress.address_select_form.select_address.value >0 ">Use this Address</a>
                </div>

            </div>
        </div>
    </div>
</div>