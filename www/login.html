<!-- Wappler include head-page="index.html" is="dmx-app" id="onboarding" appConnect="local" framework7_6="With App Connect" framework7_icons="local" capacitor="local" bootstrap_icons="local" components="{dmxFormatter:{},dmxScheduler:{}}" fontawesome_5="local" -->

<div class="page welcome-screen" data-name="login" path="/login" id="login">

    <div class="page-content wappler-block">
        <dmx-scheduler id="submit_gogle_form" dmx-on:tick="run({condition:{if:`app.main.login.GoogleSignInForm.googleImgUrl.value`,then:{steps:{run:{action:`app.main.login.GoogleSignInForm.submit()`}}}}})" delay="1"></dmx-scheduler>
        <div class="container welcome-inner">
            <div class="text-align-center">
                <div class="main-logo center mb-10">

                    <h2 class="logo-name"><img src="assets/images/login-logo.png"></h2>
                </div>
                <h4 class="ma-0 text-color-primary strong montserrat">Full service mobile salon &amp; spa&nbsp;</h4>
            </div>
            <div class="clearfix pb-30">
                <form action="https://api.justpro.me/api/security/login_register_with_number" is="dmx-serverconnect-form" method="post" id="login_register_with_number" site="JustPro-Spa-Backend" dmx-on:invalid="run({'f7.dialog.alert':{title:'Error',text:`app.main.login.login_register_with_number.lastError.response`}})" dmx-on:success="run({condition:{if:`app.main.login.login_register_with_number.data.Logged_in_user_id`,then:{steps:[{run:{action:`app.local_store.set(\'user_id\',app.main.login.login_register_with_number.data.Logged_in_user_id)`}},{runJS:{function:'addExternalUserId',args:[`app.main.login.login_register_with_number.data.Logged_in_user_id.toString()`]}},{condition:{if:`!app.Current_user.data.customer.phone_number_verified`,then:{steps:{condition:{if:`(app.main.login.login_register_with_number.data.send_otp_for_login_user.api.data.status == \'open\')`,then:{steps:[{run:{action:`app.otp_id.setValue(app.main.login.login_register_with_number.data.send_otp_for_login_user.api.data.otp_id)`}},{runJS:{function:'startOtpWatch'}},{run:{action:`app.main.navigate(\'/verifyOtp\',{})`}}]}}}},else:{steps:{run:{action:`app.main.navigate(\'/order-prompt\',{})`}}}}}]},else:{steps:[{run:{action:`app.local_store.set(\'user_id\',app.main.login.login_register_with_number.data.insert.identity)`}},{runJS:{function:'addExternalUserId',args:[`app.main.login.login_register_with_number.data.insert.identity.toString()`]}},{condition:{if:`!app.Current_user.data.customer.phone_number_verified`,then:{steps:{condition:{if:`(app.main.login.login_register_with_number.data.send_otp_for_login_user.api.data.status == \'open\')`,then:{steps:[{run:{action:`app.otp_id.setValue(app.main.login.login_register_with_number.data.send_otp_for_login_user.api.data.otp_id)`}},{runJS:{function:'startOtpWatch'}},{run:{action:`app.main.navigate(\'/verifyOtp\',{})`}}]}}}},else:{steps:{run:{action:`app.main.navigate(\'/order-prompt\',{})`}}}}}]}}})">
                    <div class="list">
                        <ul class="row">
                            <li class="item-content item-input col-100">
                                <div class="item-inner">
                                    <div class="item-title item-label">Mobile number</div>
                                    <div class="item-input-wrap row">
                                        <div class="col-30">
                                            <select id="country_code" class="form-control" name="country_code" dmx-bind:options="app.countryList.data" optiontext="code+' '+dial_code" optionvalue="code" dmx-bind:value="'AE'">
                                            </select>
                                        </div>
                                        <div class="col-70"><input type="number" placeholder="052 xxx xxxx" class="form-control" id="mobile_number" dmx-bind:value="app.Current_user.data.customer.phone_number" name="mobile_number" /></div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <button href="" class="button-large button-18 button-social rounded-xl button-fill mb-40" dmx-on:click="app.main.login.login_register_with_number.submit()" dmx-bind:disabled="app.main.login.login_register_with_number.state.executing" style="width:100% !important"><i class="bi-telephone-fill text-color-white" dmx-hide="app.main.login.login_register_with_number.state.executing"></i> <span dmx-hide="app.main.login.login_register_with_number.state.executing">Login With Mobile Number</span>
                        <div class="preloader color-white" dmx-show="app.main.login.login_register_with_number.state.executing"></div>

                    </button>
                </form>
                <!-- dmx-on:click="run({runJS:{function:'loginWithFb'}})"-->
                <a href="/order-prompt" class="button-large button-18 button-social rounded-xl button-fill facebook" style="width:100% !important"><img src="img/social/facebook.png" alt=""> <span>Login with facebook</span></a>
                <form id="GoogleSignInForm" is="dmx-serverconnect-form" method="post" action="https://api.justpro.me/api/security/login_with_google" site="JustPro-Spa-Backend" dmx-on:success="run({condition:{if:`app.main.Login.GoogleSignInForm.data.set_new_user_id`,then:{steps:[{runJS:{function:'addExternalUserId',args:[`app.main.login.GoogleSignInForm.data.set_new_user_id.toString()`]}},{run:{action:`app.local_store.set(\'user_id\',app.main.login.GoogleSignInForm.data.set_new_user_id);app.main.navigate(\'/home\',{clearPreviousHistory: true, history: false})`}}]},else:{steps:[{runJS:{function:'addExternalUserId',args:[`app.main.login.GoogleSignInForm.data.set_login_user_id.toString()`]}},{run:{action:`app.local_store.set(\'user_id\',app.main.login.GoogleSignInForm.data.set_login_user_id);app.main.navigate(\'/home\',{clearPreviousHistory: true, history: false})`}}]}}})" dmx-on:error="run({'f7.dialog.alert':{title:'Error',text:'User not found, try other login methods.'}})"><input id="first_name" name="first_name" type="hidden"><input id="last_name" name="last_name" type="hidden"><input id="email" name="email" type="hidden"><input id="googleImgUrl" name="googleImgUrl" type="hidden"><input id="password" name="password" type="hidden">
                    <input id="GoogleSignInFormLong" name="long" type="hidden" dmx-bind:value="geoLocation.coords.longitude">
                    <input id="GoogleSignInFormLat" name="lat" type="hidden" dmx-bind:value="geoLocation.coords.latitude">
                </form>
                <button class="button-large button-18 button-social bg-color-white text-color-black rounded-xl button-outline google mt-15" dmx-on:click="run({runJS:{function:'googleSignIn'}})" dmx-bind:disabled="app.main.login.GoogleSignInForm.state.executing" style="width:100% !important"><img src="img/social/google-mail.png" alt="" dmx-hide="app.main.login.GoogleSignInForm.state.executing"> <span dmx-hide="app.main.login.GoogleSignInForm.state.executing">Login with Google</span>
                    <div class="preloader color-purple" dmx-show="app.main.login.GoogleSignInForm.state.executing"></div>
                </button>
            </div>
        </div>
    </div>
</div>